<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Devienne Fou - Raider.IO</title>
    <link rel="stylesheet" th:href="@{/css/styles.css}" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script> <!-- Including jQuery for simplicity -->
</head>
<body>
<h1>Devienne Fou - Raider.IO</h1>

<!-- Section to List Guild Members Based on Rank -->
<section>
    <h2>Get Guild Members by Rank</h2>
    <button th:action="@{/synchronize}" method="get" type="submit">Synchronize</button>

    <div th:if="${members}">
        <h3>Members with Rank [[${rank}]]</h3>
        <ul>
            <li th:each="member : ${members}">
                <strong th:text="${member.character.name}"></strong> - Class: [[${member.character.wowClass}]] - Race: [[${member.character.race}]]
                <!-- Use data-* attribute to store the member name -->
                <button type="button" th:data-name="${member.character.name}" th:data-realm="${member.character.realm}" onclick="fetchProfile(this)">View Profile</button>
            </li>
        </ul>
    </div>
</section>

<!-- Empty container to append player profiles -->
<section id="profiles">
    <h2>Player Profiles</h2>
    <!-- Player profiles will be appended here by JavaScript -->
</section>

<script>
    function fetchProfile(button) {
        // Retrieve the player's name from the data-* attribute
        const playerName = $(button).data('name');
        const playerRealm = $(button).data('realm');

        $.ajax({
            url: '/profile',
            method: 'GET',
            data: { name: playerName, realm: playerRealm},
            success: function(data) {
                // Append the profile to the profiles section
                $('#profiles').append(data);
            },
            error: function() {
                alert('Failed to fetch profile for ' + playerName);
            }
        });
    }
</script>
</body>
</html>
